<!DOCTYPE html>
<html lang="en">

<head>
    <title>Feeder | JQM</title>
    <meta name="author" content="fadilxcoder" />
    <meta name="copyright" content="fadilxcoder" />
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css?family=Titillium+Web" rel="stylesheet">
    <link rel="stylesheet" href="./assets/jquery.mobile-1.4.5.min.css">
    <link rel="stylesheet" href="./assets/jquery.mobile-style.css">
    <script src="./assets/jquery.mobile-1.12.4-jquery.min.js"></script>
    <script src="./assets/jquery.mobile-1.4.5.min.js"></script>
    <link rel="manifest" href="/manifest.json">
</head>

<body>
    <div data-role="page" id="home-page" data-theme="a">
        <header data-role="header" role="banner">
            <picture>
                <img src="./assets/images/jquery-logo.png" alt="Logo JQM" />
            </picture>
            <h1>RSS FEED</h1>
            <picture>
                <img src="./assets/images/image.gif" alt="Banner Image" />
            </picture>
        </header>
        <div data-role="content">
            <ul data-role="listview" data-inset="true" id="ListContainer"></ul>
        </div>
        <footer data-role="footer" data-position="fixed">
            <div data-role="navbar">
                <ul>
                    <li><a href="#" data-rel="back" data-icon="ui-btn ui-icon-back"></a></li>
                    <li><a href="index.html" data-transition="flow" data-ajax="false" data-icon="ui-btn ui-icon-home"></a></li>
                    <li><a href="#" data-transition="flip" data-ajax="false" data-icon="ui-btn ui-icon-bullets"></a></li>
                    <li><a href="#" data-transition="slideup" data-ajax="false" data-icon="ui-btn ui-icon-comment"></a></li>
                </ul>
            </div>
        </footer>
    </div>

    <div data-role="page" id="popup">
        <div data-role="header" data-theme="a">
            <h1></h1>
        </div>
        <div role="main" class="ui-content">
            <h2></h2>
            <p></p>
        </div>
    </div>
    <script type="text/javascript">

        const APP_CONFIG = {
            'URL' : 'http://127.0.0.1/pwa/public/rss.php',
            'CACHE' : 'jqa-pwa'
        };
        
        // Registering SW
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js?vars=' + encodeURIComponent(JSON.stringify(APP_CONFIG)))
            .then(function() {
                console.log('SW registered');
            });
        }

        $(document).ready(function () {
            return;
            $.ajax({
                dataType: 'json',
                url: APP_CONFIG.URL,
                cache: true,
                type: 'GET',
                success: function (data) {
                    showData(data);
                    console.log('200 OK');
                },
                error: function (e) {
                    console.log(e.statusText + ':' + e.status);
                },
                fail: function () {
                    console.log("Request Fail");
                }
            });
        });
        
        $(document).on('click', 'li.click-to-pop-up', function () {
            var title = $(this).children('a').attr('data-title');
            var description = $(this).children('a').attr('data-description-text').replace('To read this article in full, please click here', ''); // clean string !
            $('#popup div.ui-content h2').text(title);
            $('#popup div.ui-content p').text(description);
        });

        // function Show Data
        function showData(data) {
            var table = '';
            $.each(data, function (idx, obj) {
                table += (
                    '<li class="click-to-pop-up"><a href="#popup" data-rel="dialog" data-transition="flip" data-description-text="' +
                        obj.description + '" data-title="' + obj.title + '" >' + obj.title +
                    '</a></li>'
                );
            });
            $("#ListContainer").append(table);
            $("#ListContainer li").addClass('ui-first-child ui-last-child');
            $("#ListContainer li a").addClass('ui-btn ui-btn-icon-right ui-icon-carat-r');
        }
    </script>
</body>

</html>